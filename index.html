<!DOCTYPE html>
<html lang="en">
<head>
  <title>Love Game</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="header">
  <h1>Love Game</h1>
  <p>~ A Quest to Assess your Mental, Physical, and Emotional Health ~</p>
</div>

<div class="navbar">
  <a href="index.html">Play</a>
  <a href="about.html">About</a>
  <a href="#">Community</a>
  <a href="#" class="right">Log In</a>
</div>
  
<div id="intro-overlay">
  <canvas id="starfield"></canvas>
  <div id="intro-text">ENTERING CYBERSPACE . . .</div>
</div>

<script>
const overlay = document.getElementById("intro-overlay");

// SESSION CHECK: Only run the intro if the user hasn't seen it this session
if (sessionStorage.getItem("introSeen")) {
  overlay.remove();
} else {
  startIntro();
}

function startIntro() {
  const canvas = document.getElementById("starfield");
  const ctx = canvas.getContext("2d");

  const starColors = [
    [255, 255, 255], // soft white
    [200, 220, 255], // pale blue
    [220, 200, 255], // lavender
    [255, 230, 180], // warm gold
    [180, 255, 240]  // mint/cyan
  ];

  let stars = [];
  let shootingStars = [];
  let running = true;

  /* Resize */
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener("resize", resize);

  /* Create Background Stars */
  function createStars(count = 140) {
    stars = [];
    for (let i = 0; i < count; i++) {
      const color = starColors[Math.floor(Math.random() * starColors.length)];
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 1.6 + 0.3,
        speed: Math.random() * 0.15 + 0.05,
        color
      });
    }
  }

  /* Create Big Shooting Stars */
  function createShootingStar() {
    shootingStars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height * 0.5,
      vx: Math.random() * 8 + 6,
      vy: Math.random() * 4 + 3,
      life: 0,
      color: "rgba(255, 255, 255, 0.9)"
    });
  }

  /* Create Fiery Embers from the Edges */
  function createEmber() {
    const side = Math.floor(Math.random() * 4);
    let x, y;
    if (side === 0) { x = Math.random() * canvas.width; y = 0; } 
    else if (side === 1) { x = Math.random() * canvas.width; y = canvas.height; } 
    else if (side === 2) { x = 0; y = Math.random() * canvas.height; } 
    else { x = canvas.width; y = Math.random() * canvas.height; }

    shootingStars.push({
      x: x,
      y: y,
      vx: (Math.random() - 0.5) * 6,
      vy: (Math.random() - 0.5) * 6,
      life: 0,
      color: "#ffca28" // Bright Fire Orange
    });
  }

  createStars();

  /* Animation Loop */
  function animate() {
    if (!running) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    /* Draw Background Stars */
    stars.forEach(star => {
      star.y += star.speed;
      if (star.y > canvas.height) star.y = 0;
      const flicker = 0.6 + Math.random() * 0.4;
      ctx.fillStyle = `rgba(${star.color[0]}, ${star.color[1]}, ${star.color[2]}, ${flicker})`;
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.r, 0, Math.PI * 2);
      ctx.fill();
    });

    /* Draw Shooting Stars & Embers */
    shootingStars.forEach((s, i) => {
      s.x += s.vx;
      s.y += s.vy;
      s.life++;

      ctx.strokeStyle = s.color;
      ctx.lineWidth = 1.5;
      ctx.shadowBlur = 10;
      ctx.shadowColor = s.color;

      ctx.beginPath();
      ctx.moveTo(s.x, s.y);
      ctx.lineTo(s.x - s.vx * 2, s.y - s.vy * 2);
      ctx.stroke();
      ctx.shadowBlur = 0;

      if (s.life > 35) shootingStars.splice(i, 1);
    });

    // Randomly spawn embers every frame
    if (Math.random() > 0.8) createEmber();

    requestAnimationFrame(animate);
  }

  const shootingInterval = setInterval(() => {
    if (Math.random() > 0.5) createShootingStar();
  }, 600);

  function endIntro() {
    running = false;
    clearInterval(shootingInterval);
    sessionStorage.setItem("introSeen", "true"); // Mark as seen
    overlay.style.transition = "opacity 0.8s ease";
    overlay.style.opacity = "0";
    setTimeout(() => overlay.remove(), 800);
  }

  const AUTO_END = 3000;
  const timeout = setTimeout(endIntro, AUTO_END);

  /* Skip Listeners */
  overlay.addEventListener("click", endIntro, { once: true });
  window.addEventListener("keydown", endIntro, { once: true });

  animate();
}
</script>
</body>
</html>
